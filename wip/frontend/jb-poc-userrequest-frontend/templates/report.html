<!doctype html>
<!-- Unfinished front end -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> 
	

    <title>Checkout example for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="../libext/vendor/twbs/bootstrap/dist/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/css/ol.css" type="text/css">

    <script src="https://cdn.rawgit.com/openlayers/openlayers.github.io/master/en/v5.3.0/build/ol.js"></script>
	
	
    <!-- Custom styles for this template -->
    <style>
		.full-width {
			max-width: none;
			width: 90% !important;
		}

		.border-top { 
			border-top: 1px solid #e5e5e5; 
		}
		
		.border-bottom { 
			border-bottom: 1px solid #e5e5e5; 
		}
			
		.border-top-gray { 
			border-top-color: #adb5bd; 
		}

		.box-shadow { 
			box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05); 
		}

		.lh-condensed { 
			line-height: 1.25; 
		}
		
		#attachment {
			height: none;
		}
		
		.btn-primary {
			background-color: rgb(6,80,140);
		}
		
		.ol-zoom button {
			height: 3rem;
			width: 3rem;
		}
		
	</style>
	
  </head>

  <body class="bg-light">

    <div class="container full-width">
      <div class="pt-5 row">
	   
              <div class="col-md-1 mb-3">
					<img class="d-block mx-auto mb-4" src="https://getbootstrap.com/docs/4.0/assets/brand/bootstrap-solid.svg" alt="" width="72" height="72">
				</div>
			
              <div class="col-md-11 mb-3 ">
			
					<h2 class="mx-3">Report problem</h2>
					<p class="mx-3 lead">Spotted a problem with our infrastructure? Let us know.</p>
					
		
		 
			
			</div>
      </div>
	  
	  
	  
	  
			

      <div class="row">
	  
	  
	  
	  
	  
        <div class="col-md-4 order-md-1 mb-4">
		
		
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Before you submit</span> 
          </h4>
          <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-condensed">
              <div>
                <h6 class="my-0">Street lights</h6>
                <small class="text-muted">We do not service street lights. Direct your report to ...</small>
              </div> 
            </li>
            
          </ul>
 
		  
		  
        </div>
        <div class="col-md-8 order-md-2">
		
		
		
			
			<div id="map" class="map" style="height: 400px;"></div>
					
          
						
			<div class="row">
              <div class="col-md-12 mb-3">
                <label for="geomtype">Geometry type</label>
                <select class="custom-select d-block w-100" id="geomtype" required="">
				<option value="Point">Point</option>
				<option value="LineString">LineString</option>
				<option value="Polygon">Polygon</option> 
                </select>
                
              </div>
			
			</div>
			<div class="row">
			
			  
				<div class="col-md-12 mb-3"> 
					<div class="custom-control custom-checkbox">
					  <input type="checkbox" class="custom-control-input" id="geolocate-agree">
					  <label class="custom-control-label" for="geolocate-agree">Show my GPS-location </label>
					</div> 				
				</div>
				
            </div>
			
			
			
			
			
          <h4 class="mb-3">Contact info</h4>
          <form class="needs-validation" novalidate>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="firstName">First name</label>
                <input type="text" class="form-control" id="firstName" placeholder="" value="" required>
                <div class="invalid-feedback">
                  Valid first name is required.
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <label for="lastName">Last name</label>
                <input type="text" class="form-control" id="lastName" placeholder="" value="" required>
                <div class="invalid-feedback">
                  Valid last name is required.
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="email">Email </label>
              <input type="email" class="form-control" id="email" placeholder="you@example.com">
              <div class="invalid-feedback">
                Please enter a valid email address for shipping updates.
              </div>
            </div>
			
            <div class="mb-3">
              <label for="phone">Phone number <span class="text-muted">(Optional)</span> </label>
              <input type="text" class="form-control" id="phone">
               
            </div>
			

            <div class="mb-3">
              <label for="address">Address </label>
              <input type="text" class="form-control" id="address" placeholder="" required>
              <div class="invalid-feedback">
                Please enter your address.
              </div>
            </div>
 

            <div class="row">
			 
			  
              <div class="col-md-6 mb-3">
                <label for="zip">Zip</label>
                <input type="text" class="form-control" id="zip" placeholder="8870" required>
                <div class="invalid-feedback">
                  Zip code required.
                </div>
              </div>
			  
              <div class="col-md-6 mb-3">
                <label for="country">City</label>
                <input type="text" class="form-control" id="city" placeholder="Izegem" required>
                <div class="invalid-feedback">
                  City required.
                </div>
                </div>
          
		  
			  
            </div>
			
			
			
			
			
			
            <hr class="mb-4">

            <h4 class="mb-3">My report is about ...</h4>

            <div class="d-block my-3">
				<!-- Get this from our backend? -->
              <div class="custom-control custom-radio">
                <input id="pavement" name="service_category_id" type="radio" class="custom-control-input" checked required>
                <label class="custom-control-label" for="pavement">Pavement</label>
              </div>
              <div class="custom-control custom-radio">
                <input id="streetLights" name="service_category_id" type="radio" class="custom-control-input" required>
                <label class="custom-control-label" for="streetLights">Street lights</label>
              </div>
              <div class="custom-control custom-radio">
                <input id="greenZones" name="service_category_id" type="radio" class="custom-control-input" required>
                <label class="custom-control-label" for="greenZones">Green zones</label>
              </div>
            </div>
			
			
			
			<hr>
			
			
			

            <div class="mb-3">
              <label for="attachment">Attachment <span class="text-muted">(Optional)</span></label>
              <input type="file" class="form-control-file" id="attachment" >
              
            </div>
 
 
            <hr class="mb-4">
			
			
			
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" id="gdpr-agree">
              <label class="custom-control-label" for="gdpr-agree">My information may be stored and processed to handle this request (GDPR) </label>
            </div>
			
			 
			
            <hr class="mb-4">
			
            <button class="btn btn-primary btn-lg btn-block" type="submit">Report</button>
          </form>
        </div>
      </div>

      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1">&copy; 2018 - {{ "now"|date("Y") }}</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="">Privacy Statement</a></li>
        </ul>
      </footer>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../libext/vendor/components/jquery/jquery.js"></script>
    <script src="../libext/vendor/twbs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
	
    <script>
      // Example starter JavaScript for disabling form submissions if there are invalid fields
      (function() {
        'use strict';

        window.addEventListener("load", function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = $(".needs-validation");

          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
              }
              form.classList.add('was-validated');
            }, false);
          });
        }, false);
      })();
	  
	  
		function createTicket() {
		
			$.post("api.php", { 
				action: "createTicket",
				ticket: {
					title: "A test report from the front-end",
					description: "A test description from the front-end"
				}
			}, function(data){ 
				console.log(data); 
				test = data;
				var ticketFields = data.ticket.objects[ Object.keys(data.ticket.objects)[0] ].fields;
				console.log("Created a ticket with Ref " + ticketFields.ref ); 
			}, "json");
		
		}
		
		
		// OpenLayers 
		
			var raster = new ol.layer.Tile({
			source: new ol.source.OSM()
		  });

		  
		  var sharedStyle = new ol.style.Style({
			  fill: new ol.style.Fill({
				color: 'rgb(6,80,140, 0.25)'
			  }),
			  stroke: new ol.style.Stroke({
				color: 'rgb(6,80,140)',
				width: 2
			  }),
			  image: new ol.style.Circle({
				radius: 7,
				fill: new ol.style.Fill({
				  color: 'rgb(139,196,88)'
				})
			  })
			});
		
		  var source = new ol.source.Vector();
		  var vector = new ol.layer.Vector({
			source: source,
			style: sharedStyle 
		  });

		  var map = new ol.Map({
			layers: [raster, vector],
			target: 'map',
			view: new ol.View({
			  center: [-11000000, 4600000],
			  zoom: 18
			})
		  });

		  var modify = new ol.interaction.Modify({source: source});
		  map.addInteraction(modify);

		  var draw, snap; // global so we can remove them later
		  

		  function addInteractions() {
			draw = new ol.interaction.Draw({
			  source: source,
			  type: $("#geomtype").val(),
			  style: sharedStyle
			});
			map.addInteraction(draw);
			snap = new ol.interaction.Snap({source: source});
			map.addInteraction(snap);

		  }

		  /**
		   * Handle change event.
		   */
		  $(document.body).on("change", "#geomtype", function() {
			console.log("change!");
			map.removeInteraction(draw);
			map.removeInteraction(snap);
			addInteractions();
		  });

		  addInteractions();
		  
		  
		// Geolocation 
		
		
			var geolocation = new ol.Geolocation({
			// enableHighAccuracy must be set to true to have the heading value.
			trackingOptions: {
			  enableHighAccuracy: true
			},
			projection: map.getView().getProjection()
		  });
		   
		  
		  $(document.body).on("change", "#geolocate-agree", function() {
		  
			geolocation.setTracking( $("#geolocate-agree").prop("checked")  );
		  
		  });
			
	  
		  // handle geolocation error.
		  geolocation.on("error", function(error) {
			console.log( error.message ); 
		  });

		  

		  
		  geolocation.on('change:position', function() {
			var coordinates = geolocation.getPosition();
			// positionFeature.setGeometry(coordinates ?  new Point(coordinates) : null);
			
			console.log()
			// center map instead 
			if( coordinates ) {
				map.getView().setCenter( coordinates );
			}
			
		  });
		  
		
	  
    </script>
  </body>
</html>
